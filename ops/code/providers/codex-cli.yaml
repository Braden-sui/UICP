version: 1
name: codex-cli
description: OpenAI Codex CLI in minimal container (no network by default)
container:
  image: ${CODEX_IMAGE:-uicp/codex-cli:latest}
  runtime: auto
  workdir: /workspace
  mounts:
    - source: ${WORKSPACE_DIR}
      target: /workspace
      type: bind
  network: bridge
  env:
    - name: OPENAI_API_KEY
      from_env: OPENAI_API_KEY
    - name: PROVIDER_KEY
      value: codex
    - name: ALLOWLIST_JSON
      value: /workspace/ops/code/network/allowlist.json
  entry: ["/usr/local/bin/codex"]
defaults: {}
hardening:
  httpjail:
    enabled: true
    policy_file: ops/code/network/allowlist.json
    provider_key: codex
    methods: ["GET", "HEAD", "OPTIONS"]
    block_post: true
notes:
  - Network is default-deny via firewall; httpjail enforces host/methods as a secondary guard.
  - Build image with: docker build -t uicp/codex-cli:latest ops/code/images/codex-cli
  - Codex CLI writes JSONL sessions under ~/.codex/sessions; harvester consumes recent logs.
