version: 1
name: claude-cli
description: Anthropic Claude Code CLI inside hardened devcontainer
container:
  image: ${CLAUDE_IMAGE:-uicp/claude-code:latest}
  runtime: auto  # docker|podman|auto
  workdir: /workspace
  mounts:
    - source: ${WORKSPACE_DIR}
      target: /workspace
      type: bind
  network: bridge  # firewall script enforces default deny + allowlist
  env:
    - name: ANTHROPIC_API_KEY
      from_env: ANTHROPIC_API_KEY
    - name: PROVIDER_KEY
      value: claude
    - name: ALLOWLIST_JSON
      value: /workspace/ops/code/network/allowlist.json
  entry: ["/usr/local/bin/claude"]
defaults:
  output_format: stream-json
  permission_mode: acceptEdits
  allowed_tools: ["Read", "Bash(npm test)"]
hardening:
  httpjail:
    enabled: true
    policy_file: ops/code/network/allowlist.json
    provider_key: claude
    methods: ["GET", "HEAD", "OPTIONS"]
    block_post: true
  flags:
    - "--dangerously-skip-permissions"  # only safe inside this container with firewall
notes:
  - Only enable --dangerously-skip-permissions inside this container with firewall.
  - Build image with: docker build -t uicp/claude-code:latest ops/code/images/claude-code
  - Firewall: ENTRYPOINT runs with-firewall.sh; method filtering is enforced by httpjail wrapper.
